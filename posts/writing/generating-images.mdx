---
title: "Statically Generating Screenshots"
publishedAt: "Jan 23"
description: "Automatically generating screenshots at an interval of time with Github Actions."
status: "public"
---

The idea of generating screenshots dynamically rose while I was _exploring_ different methods of displaying images which needed to be updated on a regular basis.

What I mean by _updated_ is that the image needed to be invalidated after a certain amount of time, creating a new one. This was mainly because I was trying to serve up to date screenshots of apps that were changing very often.

I started by experimenting with using an API endpoint that took screenshot with Chromium, then _caching_ it with HTTP headers. I also used [Microlinkâ€™s Screenshot API](https://microlink.io/screenshot), which was a much _simpler_ solution since it replaced my endpoint with only a few lines of code. However, I came to the conclusion that HTTP caching was not good enough because the first visitor to an uncached image would have to wait **5-7 seconds**! Instead, I decided to _pivot and focus_ on serving static images that have no extreme loading times.

## The goal

To give you a little bit of context, what I wanted to achieve is a link preview component. If you are not familiar with what a link preview is, you can check out [this article](https://uiw.tf/link-preview).

Besides a _pleasing UI_, I wanted to have screenshots that were served statically, resized to according dimensions (not too large, since they are going to be shown as small images), saved as `webp` (also to keep them as tiny as possible) and also regularly updated.

An example of a screenshot that may change often is your _twitter profile_, due to profile/cover picture changes and retweets.

#### Note

For those who are curious about what is the `webp` image format:

> WebP is a modern image format that provides superior lossless and lossy compression for images on the web. Using WebP, webmasters and web developers can create smaller, richer images that make the web faster.

## Generating screenshots with Github Actions

The first thing that came to my mind while I was thinking about a mechanism that is going to automatically generate the screenshots was by using **Github Actions**.

### But... who?

The idea is straight-forward. We will use a workflow with a cron job that runs a script that generates all the images and pushes them back to the repository.

### Workflow

The action can be found in `.github/workflows/screenshots.yaml` and it looks like this:

```yaml
name: Generate screenshots

on:
  schedule:
    - cron: "0 */12 * * *"

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: DerYeger/yarn-setup-action@master
        with:
          node-version: 16
      - name: yarn install
        run: yarn
      - name: make screenshots
        run: yarn run screenshots
      - name: push to repository
        run: |
          git config --global user.name 'Your Name'
          git config --global user.email 'username@users.noreply.github.com'
          git pull origin main
          git commit -am "Automated screenshots"
          git push
```

#### Note

`DerYeger/yarn-setup-action@master` is used because **yarn** is my package manager of choice.

### The script

Firstly, the script runs a cleanup function which is going to remove the `public/` folder, creates an instance of a _Headless Browser_ then iterates through an array of objects (constants, which consists of name and url) and takes the screenshot for both _light_ and _dark_ color scheme for all of them.

After each set of screenshots is done, we are going to resize the images and save them with the `webp` extension.

#### Notes

1. The resizing is done by using [sharp](https://www.npmjs.com/package/sharp).

2. I'm using `browserless` due to its strong configuration out of the box, which is _tricks_ many applications against their bot protection. As an example, trying to screenshots your _Twitter_ account with either Puppeteer or Playwright with no prior configuration will result in screenshots that are going to look like this:

![Twitter Browser no longer supported](/link-previews/twitter.png)

### Demo

I've also prepared an example app, check out the [live example](https://github-actions-images.vercel.app/) and also the [source code](https://github.com/mariusflorescu/github-actions-images).

![Live example](/link-previews/example.gif)

### Room for improvements

This action seems to run perfectly, but we must ask ourselves _what happens if the Headless Browser cannot connect to the website or something else goes wrong ?_ In the current state, the script would **fail and not update** the repository.

A more _fail safe_ upgrade that would guarantee us that we generate as many new screenshots as we can and deliver them is to **not run** the cleanup function in the first place.

Instead, we should save the images in another folder and then replace the contents of the old screenshots with the newly generated ones.

For _new_ screenshots that need to be taken, we can either run the same action but on **push** on the `main` branch or just run the script locally and then push the changes.

## Is it worth?

Well, it depends on how much time do you want to spend on this feature.

If you have the same need that I had and you have some time for development and maintaing, this seems like a solid solution due to its _performance_.

---

If you are looking for a simpler solution, there is _Microlink's API_ (probably the most popular solution seen so far for link previews), which I mentioned above. One strong point is the _ease of use_, since you only need to build the query params and that's it, you will get an image which is going to be cached. You even have the possibility of adding configuration through query parameters, such as `colorScheme`, `waitUntil`, ...

However, from my personal experience, trying to screenshot my Twitter/Github account with Microlink ended in _almost blank_ images most of the time.

![My Twitter screenshotted by Microlink](/link-previews/my-twitter.png)
